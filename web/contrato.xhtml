<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Contrato</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <link rel="shortcut icon" href="#{facesContext.externalContext.requestContextPath}/imagens/favicon.ico"/>  
        <style type="text/css">
            .ui-widget-content .ui-inputfield{ padding: 8px!important; } 
            .ui-button { padding: 3px!important; }
            .ui-selectonemenu {padding-right: 25px!important; }
            .row-1-col-1-left {width: 830px; vertical-align: top!important}
            .row-1-col-2-right { vertical-align: top!important}
        </style>   
    </h:head>
    <h:body>
        <!-- INICIA DIV wrap e main -->
        <div id="wrapx">
            <div id="mainx">
                <!-- INICIA DIV wrap e main -->  
                <f:subview id="header">
                    <ui:include src="templates/templatePrime.xhtml"/>
                </f:subview>
                <f:view>
                    <f:metadata>
                        <f:event type="preRenderView" listener="${fotosEvolucaoBean.setRotinaNome('contrato')}"/>
                    </f:metadata>                    
                    <ui:include src="templates/templateAcessoFilial.xhtml"/>
                    <ui:include src="templates/templateStatus.xhtml"/>
                    <ui:include src="templates/templateFotosEvolucao.xhtml" />
                    <p:panel styleClass="wrapper" style="border: 0px;">
                        <h:outputText value="Contrato" styleClass="fonteHeader" />
                        <div class="clear"></div>
                        <c:set scope="request" var="object" value="${contratoBean.contrato}" id="idObject"/>
                        <h:form id="form_contrato">
                            <h:outputScript name="tradutor_primefaces.js" library="js" />
                            <h:outputScript name="script_primefaces.js" library="js" /> 
                            <p:messages showDetail="true" showIcon="true" autoUpdate="true" closable="true" />
                            <p:panel styleClass="margin-top-med" id="id_focus_panel">
                                <f:facet name="header">
                                    <p:outputLabel value="Contrato nº #{contratoBean.contrato.id}" rendered="#{contratoBean.contrato.id != null}" styleClass="font-color-red font-size-12"/>
                                    <h:panelGrid columns="2" width="1010">
                                        <h:column>
                                            <h:panelGrid columns="2">
                                                <p:outputLabel value="Unidade de cadastramento:" styleClass="bold" />
                                                <p:selectOneMenu value="#{contratoBean.idFilial}" disabled="true">
                                                    <p:ajax event="change" update="@this" global="false" />
                                                    <f:selectItems value="#{contratoBean.listFilial}" />
                                                </p:selectOneMenu>
                                                <p:outputLabel value="Unidade atual do paciente:" styleClass="bold" />
                                                <p:selectOneMenu value="#{contratoBean.idFilialAtual}" disabled="#{contratoBean.contrato.id != null}">
                                                    <p:ajax event="change" update="@this" global="false" />
                                                    <f:selectItems value="#{contratoBean.listFilialAtual}" />
                                                </p:selectOneMenu>
                                            </h:panelGrid>                                            
                                        </h:column>
                                        <h:column>
                                            <h:outputLink id="id_paciente_foto" value="#">
                                                <p:graphicImage value="#{contratoBean.contrato.paciente.foto}" cache="false" width="80" rendered="#{contratoBean.contrato.paciente.id != -1}" style="float: left;"/>
                                            </h:outputLink>
                                            <p:tooltip id="toolTipContent" for="id_paciente_foto" trackMouse="true">
                                                <h:panelGrid columns="1">
                                                    <h:outputLabel value="Foto Paciente" />
                                                    <p:graphicImage value="#{contratoBean.contrato.paciente.foto}" />                                                    
                                                </h:panelGrid>
                                            </p:tooltip>
                                        </h:column>
                                    </h:panelGrid>
                                </f:facet>
                                <h:panelGrid columns="2" cellpadding="5">
                                    <p:outputLabel value="Tipo Contrato:" styleClass="bold" />
                                    <p:selectOneMenu value="#{contratoBean.idTipoContrato}" disabled="#{contratoBean.contrato.id != null}">
                                        <p:ajax event="change" update="@this :form_contrato:" global="false" listener="#{contratoBean.listener(2)}"/>
                                        <f:selectItems value="#{contratoBean.listTipoContrato}" />
                                    </p:selectOneMenu>                                        
                                    <p:outputLabel value="Data Contratual:" styleClass="bold" />
                                    <p:calendar value="#{contratoBean.dataCadastro}" pattern="dd/MM/yyyy" mask="99/99/9999" size="8" styleClass="text-center">
                                        <p:ajax event="dateSelect" update="@this :form_contrato:" global="false" listener="#{contratoBean.listener(3)}"/> 
                                        <p:ajax event="change" update="@this :form_contrato:" global="false"/> 
                                    </p:calendar>
                                </h:panelGrid>
                                <p:panel  styleClass="margin-top-max">
                                    <f:facet name="header">
                                        <h:panelGrid columns="4">
                                            <h:outputLabel value="Responsável (Devedor 1)" styleClass="bold font-color-blue"/>
                                        </h:panelGrid>
                                    </f:facet>
                                    <h:panelGrid columns="5" cellpadding="5">
                                        <p:outputLabel value="Documento:" styleClass="margin-lef-max"/>
                                        <p:inputMask mask="999.999.999-99" value="#{contratoBean.contrato.responsavel.documento}" placeholder="999.999.999-99" size="12" title="Digite o CPF do responsável" readonly="#{contratoBean.contrato.responsavel.id != -1}">
                                            <p:ajax event="change" update="@this :form_contrato:" listener="#{contratoBean.findPessoaPorDocumento(true)}" />
                                        </p:inputMask>                                            
                                        <p:commandButton icon="ui-icon-search" title="Pesquisar responsável" action="#{chamadaPaginaBean.pesquisa('pesquisaPessoaFisica')}" disabled="false"  actionListener="#{contratoBean.putValidacao('responsavel')}" global="false"/>
                                        <p:outputLabel value="#{contratoBean.contrato.responsavel.nome}" />
                                        <p:commandButton icon="ui-icon-close" action="#{contratoBean.clear(1)}" update=":form_contrato:" rendered="#{contratoBean.contrato.responsavel.id != -1}" />
                                    </h:panelGrid>
                                </p:panel>
                                <p:panel styleClass="margin-top-max" rendered="#{contratoBean.disabled[1]}" style="color: red;">
                                    <f:facet name="header">
                                        <h:panelGrid columns="4">
                                            <h:outputLabel value="Entidade / Responsável 2 (Devedor 2)" styleClass="bold" style="color: green"/>
                                        </h:panelGrid>
                                    </f:facet>
                                    <h:panelGrid columns="5" cellpadding="5">
                                        <p:outputLabel value="CNPJ:" styleClass="margin-lef-max"/>
                                        <p:inputMask mask="99.999.999/9999-99" placeholder="99.999.999/9999-99" size="15" value="#{contratoBean.cobranca2.pessoa.documento}" title="Digite o CNPJ da entidade de cobrança" disabled="#{contratoBean.contrato.responsavel.id == -1}">
                                            <p:ajax event="change" update="@this :form_contrato:" />
                                        </p:inputMask>                                            
                                        <p:commandButton icon="ui-icon-search" title="Pesquisar entidade de cobrança" action="#{chamadaPaginaBean.pesquisa('pesquisaPessoaJuridica')}" disabled="#{contratoBean.contrato.responsavel.id == -1}"/>
                                        <p:outputLabel value="#{contratoBean.contrato.cobranca2.nome}"  />
                                        <p:commandButton icon="ui-icon-close" action="#{contratoBean.clear(5)}" update=":form_contrato:" rendered="#{contratoBean.contrato.cobranca2.id != -1}"  />
                                    </h:panelGrid>
                                </p:panel>                                
                                <p:panel styleClass="margin-top-max">
                                    <f:facet name="header">
                                        <h:panelGrid columns="2">
                                            <h:outputLabel value="Paciente" styleClass="bold"/>
                                        </h:panelGrid>
                                    </f:facet>
                                    <h:panelGrid columns="6" cellpadding="5">
                                        <p:outputLabel value="Documento:" />
                                        <p:inputMask mask="999.999.999-99" value="#{contratoBean.contrato.paciente.documento}" placeholder="999.999.999-99" size="12" title="Digite o CPF do paciente" disabled="#{contratoBean.contrato.responsavel.id == -1}" readonly="#{contratoBean.contrato.paciente.id != -1}">
                                            <p:ajax event="change" update="@this :form_contrato:" listener="#{contratoBean.findPessoaPorDocumento(false)}" />
                                        </p:inputMask>
                                        <p:commandButton icon="ui-icon-search" title="Pesquisar paciente" action="#{chamadaPaginaBean.pesquisa('pesquisaPessoaFisica')}" disabled="#{contratoBean.contrato.responsavel.id == -1}" actionListener="#{contratoBean.putValidacao('paciente')}"  global="false" rendered="#{contratoBean.contrato.id == null}"/>
                                        <p:outputLabel value="#{contratoBean.contrato.paciente.nome}" />
                                        <h:outputLabel value="Idade: #{pessoaUtilitariosBean.idade(contratoBean.contrato.paciente.id)} anos" rendered="#{contratoBean.contrato.paciente.id != -1}" styleClass="margin-left-max  font-color-red"/>
                                        <p:commandButton icon="ui-icon-close" action="#{contratoBean.clear(2)}" update=":form_contrato:" rendered="#{contratoBean.contrato.responsavel.id != -1}" disabled="#{contratoBean.contrato.id != null}" styleClass="margin-left-max"/>
                                    </h:panelGrid>
                                    <hr />
                                    <h:panelGrid columns="11" styleClass="margin-top-max" width="960">
                                        <p:outputLabel value="Data internação:" />
                                        <p:calendar value="#{contratoBean.contrato.dataInternacao}" pattern="dd/MM/yyyy" mask="99/99/9999" size="8" styleClass="text-center">
                                            <p:ajax event="dateSelect" update="@this" global="false"/> 
                                            <p:ajax event="change" update="@this" listener="#{contratoBean.contrato.selectedDataInternacao}" global="false"/> 
                                        </p:calendar>                                        
                                        <p:outputLabel value="Tipo de internação:" />
                                        <p:selectOneMenu value="#{contratoBean.idTipoInternacao}">
                                            <p:ajax event="change" update="@this" global="false" />
                                            <f:selectItems value="#{contratoBean.listTipoInternacao}" />
                                        </p:selectOneMenu>
                                        <p:outputLabel value="Previsão:" />
                                        <p:inputText value="#{contratoBean.contrato.previsaoDiasString}" size="1" maxlength="3" styleClass="text-center" converter="#{thisNumber}">
                                            <p:ajax event="blur" update="@this" global="false"/>
                                        </p:inputText>
                                        <p:outputLabel value="dia(s)" styleClass="margin-left-max"/>
                                        <p:outputLabel value="Senha:" rendered="#{contratoBean.contrato.id != null}" styleClass="font-color-red"/>
                                        <p:inputText value="#{contratoBean.contrato.senha}" maxlength="3" styleClass="text-center font-color-red" readonly="true" rendered="#{contratoBean.contrato.id != null}" size="5">
                                            <p:ajax event="blur" update="@this" global="false"/>
                                        </p:inputText>
                                    </h:panelGrid> 
                                    <hr />
                                    <p:inputTextarea value="#{contratoBean.contrato.observacao}" cols="142" maxlength="255" placeholder="Observações"></p:inputTextarea>
                                </p:panel>
                                <p style="font-size: 18pt!important; text-decoration: underline; color: blue">Financeiro</p>
                                <h:panelGrid styleClass="margin-top-max" columns="5" cellpadding="5">
                                    <p:outputLabel value="VALOR DO CONTRATO (R$): "  styleClass=" bold"/>
                                    <p:inputText value="#{contratoBean.contrato.valorTotalString}" styleClass="text-center font-size-12" onclick="selectInputText(this)" converter="#{toCurrency}" readonly="#{contratoBean.contrato.impresso}" disabled="#{(contratoBean.contrato.responsavel.id == -1) or (contratoBean.disabled[0])}">
                                        <p:ajax event="change" update="@this :form_contrato:" listener="#{contratoBean.calculaValoresTotais}" global="false"/>
                                    </p:inputText>
                                    <p:outputLabel value="Qtde de parcelas: " />
                                    <p:inputText maxlength="2" styleClass="text-center font-size-12" value="#{contratoBean.contrato.quantidadeParcelas}" disabled="#{(contratoBean.contrato.responsavel.id == -1) or (contratoBean.disabled[0])}"  readonly="#{contratoBean.contrato.impresso}" size="2">
                                        <p:ajax event="change" update="@this :form_contrato:" listener="#{contratoBean.calculaSaldoDevedor}" global="false"/>
                                    </p:inputText>
                                    <p:outputLabel value="Máximo: 24 parcelas" />
                                </h:panelGrid>
                                <p style="font-size: 14pt!important;" class="font-color-blue">DEVEDOR 1: <span style="color: black; font-size: 14pt!important;">#{contratoBean.contrato.responsavel.nome}</span></p>
                                <p:panelGrid styleClass="margin-top-max">
                                    <f:facet name="header">
                                        <p:row>
                                            <p:column>
                                                <p:outputLabel value="Valor" />                                                    
                                            </p:column>
                                            <p:column>
                                                <p:outputLabel value="Valor da entrada" />                                                    
                                            </p:column>
                                        </p:row>
                                    </f:facet>
                                    <p:row>
                                        <p:column styleClass="text-center">
                                            <p:inputText styleClass="text-center" onclick="selectInputText(this)" converter="#{toCurrency}" readonly="#{contratoBean.contrato.impresso}" value="#{contratoBean.valorTotalResponsavelString}" id="i_taxax" disabled="#{(contratoBean.disabled[0]) or (contratoBean.contrato.valorTotal) == 0}" >
                                                <p:ajax event="change" update="@this :form_contrato:" listener="#{contratoBean.calculaValoresTotais(1)}" />
                                            </p:inputText>                                        
                                        </p:column>
                                        <p:column styleClass="text-center">
                                            <p:inputText value="#{contratoBean.contrato.valorEntradaString}" styleClass="text-center" onclick="selectInputText(this)" converter="#{toCurrency}" disabled="#{(contratoBean.contrato.responsavel.id == -1 ) or (contratoBean.disabled[0])  or (contratoBean.valorTotalResponsavel == 0) }" readonly="#{contratoBean.contrato.impresso}">
                                                <p:ajax event="change" update="@this :form_contrato:" listener="#{contratoBean.calculaSaldoDevedor}" global="false"/>
                                            </p:inputText>                                        
                                        </p:column>
                                    </p:row>
                                    <p:row rendered="#{contratoBean.contrato.id == null}">
                                        <p:column styleClass="text-center">
                                            <p:commandLink value="Alterar dia de vencimento" onclick="PF('dlg_dia_vencimento').show()" style="color: blue" rendered="#{contratoBean.contrato.responsavel.id != -1}" global="false" disabled="#{contratoBean.disabled[0]}"/>
                                        </p:column>
                                        <p:column>
                                            <h:outputLabel value="Dias primeira parcela:" rendered="#{contratoBean.contrato.quantidadeParcelas == 1 or contratoBean.contrato.valorEntrada > 0}" />
                                        </p:column>
                                        <p:column>
                                            <p:inputText size="5" value="#{contratoBean.adicionarDias}" converter="#{thisNumber}" rendered="#{contratoBean.contrato.quantidadeParcelas == 1 or contratoBean.contrato.valorEntrada > 0}" title="Limite de dias contados a partir da data de vencimento da primeira parcela" disabled="#{contratoBean.disabled[0]}">
                                                <p:ajax event="change" update="@this :form_contrato:" listener="#{contratoBean.calculaSaldoDevedor}" global="false"/>
                                            </p:inputText>
                                            <p:commandLink value="?" onclick="PF('dlg_example_1').show()" styleClass="margin-left bold font-color-red" title="O que é?" global="false" rendered="#{contratoBean.contrato.quantidadeParcelas == 1 or contratoBean.contrato.valorEntrada > 0}"  disabled="#{contratoBean.disabled[0]}"/>
                                        </p:column>
                                    </p:row>
                                </p:panelGrid>
                                <p:panelGrid styleClass="margin-top-max" rendered="#{contratoBean.disabled[1]}">
                                    <p style="font-size: 14pt!important; color: green">DEVEDOR 2: <span style="color: black; font-size: 14pt!important;">#{contratoBean.contrato.cobranca2.nome}</span></p>
                                    <f:facet name="header">
                                        <p:row>
                                            <p:column>
                                                <p:outputLabel value="Valor" />                                                    
                                            </p:column>
                                            <p:column>
                                                <p:outputLabel value="Valor entrada"  />                                                    
                                            </p:column>
                                        </p:row>
                                    </f:facet>
                                    <p:row>
                                        <p:column styleClass="text-center">
                                            <p:inputText value="#{contratoBean.valorTotalCobranca2String}" styleClass="text-center" onclick="selectInputText(this)" converter="#{toCurrency}" readonly="#{contratoBean.contrato.impresso}" disabled="#{(contratoBean.contrato.cobranca2.id == -1) or (contratoBean.disabled[0])}">
                                                <p:ajax event="change" update="@this :form_contrato:" listener="#{contratoBean.calculaValoresTotais(2)}" global="false"/>
                                            </p:inputText>                                        
                                        </p:column>
                                        <p:column styleClass="text-center">
                                            <p:inputText value="#{contratoBean.contrato.valorEntrada2String}" styleClass="text-center" onclick="selectInputText(this)" converter="#{toCurrency}" disabled="#{(contratoBean.contrato.cobranca2.id == -1) or (contratoBean.disabled[0])}" readonly="#{contratoBean.contrato.impresso}">
                                                <p:ajax event="change" update="@this :form_contrato:" listener="#{contratoBean.calculaSaldoDevedor}" global="false"/>
                                            </p:inputText>                                        
                                        </p:column>
                                    </p:row>                                    
                                </p:panelGrid>
                                <p:panel id="id_calcula_saldo_devedor" style="background: #ccffcc; text-align: center; margin-top: 25px">
                                    <h:panelGrid columns="4" cellpadding="5">
                                        <p:outputLabel value="SALDO DEVEDOR: " style="color: red" styleClass="bold"/>
                                        <p:inputText maxlength="3" styleClass="text-center font-size-12" readonly="true" value="#{contratoBean.saldoDevedor}" disabled="#{contratoBean.disabled[0]}">
                                            <p:ajax event="change" update="@this" />
                                        </p:inputText>
                                        <p:outputLabel value="TOTAL TAXAS: " styleClass="bold"/>
                                        <p:inputText maxlength="3" styleClass="text-center font-size-12" readonly="true" value="#{contratoBean.valorTotalTaxa}" disabled="#{contratoBean.disabled[0]}">
                                            <p:ajax event="change" update="@this" />
                                        </p:inputText>
                                    </h:panelGrid>
                                </p:panel>
                                <p:panel  id="i_msg_financeiro" styleClass="margin" style="border: 0">
                                    <p:messages showDetail="true" showIcon="true" autoUpdate="true" closable="true" />                                    
                                </p:panel>
                                <h:panelGrid id="i_obs">
                                    <p:outputLabel value="#{contratoBean.calculaValorMovimentoAlterado}" styleClass="bold font-color-red"/>
                                </h:panelGrid>
                                <h:panelGrid id="i_tbl">
                                    <p:dataTable value="#{contratoBean.listMovimentoContrato}" var="movimento" styleClass="margin-top-max" rowIndexVar="index" emptyMessage="Nenhum movimento gerado!" rowStyleClass=" #{movimento.entrada ? '; bg-salmon' : ''}">
                                        <f:facet name="header">
                                            Parcelas
                                        </f:facet>
                                        <p:column width="16" styleClass="text-center">
                                            <p:graphicImage value="/imagens/icon_currency.png" title="Valor da entrada" rendered="#{movimento.entrada}" width="16"/>
                                        </p:column>
                                        <p:column width="20" styleClass="text-center">
                                            <p:graphicImage value="#{movimento.pessoa.id == contratoBean.contrato.responsavel.id ? '/imagens/icon_family_32.png' : '/imagens/icon_partnership_32.png'}" title="Responsável pelo movimento: #{movimento.pessoa.id == contratoBean.contrato.responsavel.id ? 'Responsável 1' : 'Entidade (Devdor 2)'}" width="24"/>
                                        </p:column>
                                        <p:column headerText="Documento" width="100" styleClass="text-center" style="font-size: 7.5pt!important">#{movimento.documento}</p:column>
                                        <p:column headerText="Serviços" styleClass="text-center">#{movimento.servicos.descricao}</p:column>
                                        <p:column headerText="Data do Vencimento" styleClass="text-center">
                                            <p:inputMask value="#{movimento.vencimentoString}" mask="99/99/9999" size="8" styleClass="text-center" rendered="#{movimento.id == -1}">
                                                <p:ajax event="change" update="@this" listener="#{contratoBean.alterDataVencimentoContrato(index, movimento)}"/>
                                            </p:inputMask>
                                            <h:outputLabel value="#{movimento.vencimentoString}"  rendered="#{movimento.id != -1}" />
                                        </p:column>
                                        <p:column headerText="Valor Parcela" styleClass="text-center">
                                            <p:inputText value="#{movimento.valorString}" converter="#{toCurrency}" styleClass="text-center" rendered="#{movimento.id == -1}" size="10" onclick="selectInputText(this)">
                                                <p:ajax update="@this :form_contrato:i_obs" event="change" global="false"/>
                                            </p:inputText>
                                            <h:outputLabel value="#{movimento.valorString}"  rendered="#{movimento.id != -1}" styleClass="text-center #{movimento.entrada ? '; bold' : ''}" title="#{movimento.entrada ? 'Entrada' : ''}" />
                                        </p:column>
                                        <p:column headerText="Data de Quitação" styleClass="text-center" width="100">
                                            <p:inputMask mask="99/99/9999" value="#{movimento.baixa.baixa}" styleClass="text-center" disabled="true" size="8"/>
                                        </p:column>
                                        <p:column headerText="Tipo Documento" styleClass="text-center" width="80">
                                            <p:commandLink value="#{movimento.tipoDocumento.descricao}" action="#{contratoBean.editMovimento(index, movimento)}" oncomplete="PF('dlg_update_ftipo_documento_ctr').show();" update=":form_contrato:id_update_ftipo_documento_ctr" styleClass="font-color-red" disabled="#{movimento.id != -1}" global="false"/>
                                        </p:column>
                                        <p:column width="25" styleClass="text-center">
                                            <h:commandLink action="#{contratoBean.printBoletos(movimento.nrCtrBoleto)}" rendered="#{contratoBean.contrato.id != null}" disabled="#{(contratoBean.disabledPrint(movimento))}" >
                                                <p:button icon="ui-icon-print" disabled="#{(contratoBean.disabledPrint(movimento))}" />
                                            </h:commandLink>
                                        </p:column>
                                        <p:column width="25" styleClass="text-center">
                                            <p:commandButton icon="ui-icon-gear" action="#{contratoBean.editMovimento(index, movimento)}" oncomplete="PF('dlg_update_ftipo_documento_ctr').show();" update=":form_contrato:id_update_ftipo_documento_ctr"  rendered="#{contratoBean.contrato.id != null}" disabled="#{(contratoBean.disabledPrint(movimento))}" />
                                        </p:column>
                                    </p:dataTable>
                                </h:panelGrid>
                                <h:panelGrid id="i_tblx">
                                    <p:dataTable value="#{contratoBean.listMovimentoTaxa}" var="movimento" emptyMessage="Nenhum movimento gerado!" rowIndexVar="index"  rowStyleClass="bg-yellow-ligth" rendered="#{contratoBean.listMovimentoTaxa.size() > 0}">
                                        <f:facet name="header">
                                            Taxas
                                        </f:facet>
                                        <p:column width="16">

                                        </p:column>
                                        <p:column width="20">

                                        </p:column>
                                        <p:column width="100" styleClass="text-center" style="font-size: 7.5pt!important">#{movimento.documento}</p:column>
                                        <p:column>
                                            #{movimento.servicos.descricao}
                                        </p:column>
                                        <p:column styleClass="text-center">
                                            <p:inputMask value="#{movimento.vencimentoString}" mask="99/99/9999" size="8" styleClass="text-center #{movimento.vencimento == null ? '' : ''}" rendered="#{movimento.id == -1}" converter="#{isDateString}">
                                                <p:ajax event="change" update="@this" listener="#{contratoBean.alterDataVencimentoTaxa(index, movimento)}"/>
                                            </p:inputMask>
                                            <h:outputLabel value="#{movimento.vencimentoString}"  rendered="#{movimento.id != -1}" />
                                        </p:column>
                                        <p:column styleClass="text-center">#{movimento.valorString}</p:column>
                                        <p:column styleClass="text-center" width="80">
                                            <p:inputMask mask="99/99/9999" value="#{movimento.baixa.baixa}" styleClass="text-center" disabled="true" size="8" />
                                        </p:column>
                                        <p:column styleClass="text-center"  width="80">
                                            <p:commandLink value="#{movimento.tipoDocumento.descricao}" action="#{contratoBean.editMovimento(index, movimento)}" oncomplete="PF('dlg_update_ftipo_documento_taxas').show();" update=":form_contrato:id_update_ftipo_documento_taxas" styleClass="font-color-red" global="false"/>
                                        </p:column>
                                        <p:column width="25" styleClass="text-center">
                                            <h:commandLink action="#{contratoBean.printBoletos(movimento.nrCtrBoleto)}" rendered="#{contratoBean.contrato.id != null}" disabled="#{(contratoBean.disabledPrint(movimento))}" >
                                                <p:button icon="ui-icon-print" disabled="#{(contratoBean.disabledPrint(movimento))}" />
                                            </h:commandLink>                                             
                                        </p:column>
                                        <p:column width="25" styleClass="text-center">
                                            <p:commandButton icon="ui-icon-close" action="#{contratoBean.removeTaxa(movimento.servicos)}" update=":form_contrato: :form_contrato:i_tblx:" rendered="#{!contratoBean.contrato.impresso}" disabled="#{controleAcessoBean.delete}"/>
                                        </p:column>
                                    </p:dataTable>
                                </h:panelGrid>
                                <h:column rendered="#{!contratoBean.contrato.impresso}">
                                    <p:panel header="Taxa extra" styleClass="margin-top-max" rendered="#{contratoBean.listTaxas.size() > 0}" id="i_tx">
                                        <h:panelGrid columns="9">
                                            <p:column>
                                                <p:outputLabel value="Serviços:" />
                                            </p:column>
                                            <p:column styleClass="text-center">
                                                <h:selectOneMenu value="#{contratoBean.idTaxa}">
                                                    <p:ajax event="change" update="@this :form_contrato:" listener="#{contratoBean.selectedServico}" global="false"/>
                                                    <f:selectItems value="#{contratoBean.listTaxas}" />
                                                </h:selectOneMenu>
                                            </p:column>
                                            <p:column>
                                                <p:outputLabel value="Valor:" styleClass="margin-left-max"/>
                                            </p:column>
                                            <p:column styleClass="text-center">
                                                <p:inputText styleClass="text-center" value="#{contratoBean.valorServico}" onclick="selectInputText(this)" converter="#{toCurrency}" disabled="#{contratoBean.disabled[0]}">
                                                    <p:ajax event="change" update="@this" global="false"/>
                                                </p:inputText>
                                            </p:column>
                                            <p:column>
                                                <p:outputLabel value="Vencimento:" styleClass="margin-left-max"/>                                                    
                                            </p:column>
                                            <p:inputMask value="#{contratoBean.vencimentoString}" mask="99/99/9999" size="8" styleClass="text-center" converter="#{isDateString}">
                                                <p:ajax event="change" update="@this" global="false"/>
                                            </p:inputMask>                                        
                                            <p:column>
                                                <p:outputLabel value="Parcelas:" styleClass="margin-left-max"/>                                                    
                                            </p:column>
                                            <p:inputText value="#{contratoBean.numeroParcelasTaxaString}" maxlength="2" size="2" styleClass="text-center" converter="#{thisNumber}">
                                                <p:ajax event="change" update="@this" global="false"/>
                                            </p:inputText>                                        
                                            <p:column>
                                                <p:commandButton action="#{contratoBean.addTaxa}" icon="ui-icon-plus" rendered="#{contratoBean.listMovimentoContrato.size() > 0}" update="i_tx :form_contrato: i_taxax" disabled="#{controleAcessoBean.save}" global="false"/>
                                            </p:column>                                        
                                        </h:panelGrid>                                    
                                    </p:panel>
                                    <p:panel header="Taxa extra" styleClass="margin-top-max" rendered="#{contratoBean.listTaxas.size() == 0}">
                                        <p:outputLabel value="Nenhuma taxa disponível!" />
                                    </p:panel>
                                </h:column>
                                <p:panel styleClass="margin-top-max" rendered="#{contratoBean.contrato.id != null}" id="i_desligamento">
                                    <f:facet name="header">
                                        <p:commandButton value="Rescindir contrato" rendered="#{contratoBean.contrato.dataRescisao == null}" styleClass="font-color-red" disabled="#{controleAcessoBean.verificarPermissao('salvar_rescisao', 1)}" onclick="PF('dlg_rescindir').show()"/>
                                        <p:commandButton value="Desfazer rescisão" rendered="#{contratoBean.contrato.dataRescisao != null}" disabled="#{controleAcessoBean.verificarPermissao('desfazer_rescisao', 2)}" onclick="PF('dlg_rescindir_2').show()"/>
                                    </f:facet>
                                    <h:panelGrid columns="10" rendered="#{contratoBean.contrato.dataRescisao != null}">
                                        <p:outputLabel value="Data:" />
                                        <p:calendar value="#{contratoBean.contrato.dataRescisao}" pattern="dd/MM/yyyy" mask="99/99/9999" size="8" styleClass="text-center">
                                            <p:ajax event="dateSelect" update="@this i_desligamento" listener="#{contratoBean.contrato.selectedDataRecisao}" global="false"/> 
                                        </p:calendar>                                        
                                        <p:outputLabel value="Tipo de desligamento:" styleClass="margin-left-max"  />
                                        <p:selectOneMenu value="#{contratoBean.idTipoDesligamento}" filter="true" filterMatchMode="startsWith" >
                                            <p:ajax event="change" update="@this" global="false" />
                                            <f:selectItems value="#{contratoBean.listTipoDesligamento}" />
                                        </p:selectOneMenu>                                        
                                    </h:panelGrid>
                                    <h:panelGrid styleClass="margin-top-max" rendered="#{contratoBean.contrato.dataRescisao != null}">
                                        <p:outputLabel value="Observação rescisória" rendered="#{contratoBean.contrato.id != null}" styleClass="bold"/>
                                        <p:inputTextarea  placeholder="Observação rescisória" value="#{contratoBean.contrato.observacaoRescisao}" cols="150" maxlength="255" rendered="#{contratoBean.contrato.id != null}"></p:inputTextarea>                                        
                                    </h:panelGrid>
                                </p:panel>
                                <f:facet name="footer" >
                                    <h:panelGrid columns="11">
                                        <p:commandButton value="Salvar" disabled="#{controleAcessoBean.save}" onclick="PF('dlg_save').show()" global="false"/>
                                        <p:commandButton action="#{contratoBean.clear}" value="Novo"  />
                                        <p:commandButton value="Excluir" disabled="#{controleAcessoBean.delete}" onclick="PF('dlg_delete').show()" rendered="#{contratoBean.contrato.id != null}"/>
                                        <p:commandButton action="#{chamadaPaginaBean.pesquisa('pesquisaContrato')}" value="Pesquisar" disabled="#{controleAcessoBean.view('pesquisaContrato')}"/>
                                        <p:commandButton value="Extrato" disabled="true" rendered="#{contratoBean.contrato.id != null}"/>
                                        <p:commandButton value="Movimentos a Receber" action="#{contratoBean.edit(contratoBean.contrato, 'movimentosReceber')}" rendered="#{contratoBean.contrato.id != null}"  />
                                        <h:commandLink action="#{contratoBean.imprimir}" disabled="#{contratoBean.contrato.id == null}" rendered="#{contratoBean.contrato.id != null}">
                                            <p:button value="Imprimir Contrato" icon="ui-icon-print" />
                                        </h:commandLink>
                                        <h:commandLink action="#{contratoBean.printBoletos}" disabled="#{contratoBean.contrato.id == null}" rendered="#{contratoBean.contrato.id != null}">
                                            <p:button value="Imprimir Boletos" icon="ui-icon-print" />
                                        </h:commandLink>
                                        <p:selectBooleanCheckbox value="#{contratoBean.imprimeVerso}" itemLabel="Imprime Verso (Boleto)" disabled="#{contratoBean.contrato.id == null}" rendered="#{contratoBean.contrato.id != null}">
                                            <p:ajax event="change" update="@this" />
                                        </p:selectBooleanCheckbox>
                                        <h:commandLink action="#{arquivoBancoBean.download}" rendered="false"> 
                                            <p:button value="Gerar arquivo remessa" icon="ui-icon-print" />
                                        </h:commandLink>
                                    </h:panelGrid>
                                </f:facet>                                
                            </p:panel>
                            <h:panelGrid columns="3" styleClass="margin-top-max">
                                <p:commandButton value="Modelos de documentos" onclick="PF('dlg_modelos_arquivos').show()" global="false" action="#{contratoBean.clear(4)}" update="i_m_a" rendered="#{not empty contratoBean.listMovimentoContrato}"/>
                                <p:commandButton value="Fotos Evolução" title="Fotos Evolução" oncomplete="PF('dlg_fotos_evolucao').show();" global="false" update="#{fotosEvolucaoBean.update}" action="#{fotosEvolucaoBean.load(contratoBean.contrato.id)}" rendered="#{contratoBean.contrato.id != null}"/>
                            </h:panelGrid>
                            <p:dialog widgetVar="dlg_save" width="400" closable="true" header="Deseja salvar este contrato?" modal="true">
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton action="#{contratoBean.save}" value="Confirmar" update=":form_contrato:" oncomplete="PF('dlg_save').hide(); PF('dlg_message').show();"/>
                                        <p:commandButton value="Cancelar" onclick="PF('dlg_save').hide()"/>
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_example_1" width="400" closable="true" header="Exemplo" modal="true">
                                <h:panelGrid columns="1">
                                    <h:outputLabel value="Se a primeira parcela vence no dia 01/01/2000, então serão " />
                                    <h:outputLabel value="acrescidos dias a partir do dia deste vencimento." /> <br />
                                    <h:outputLabel value="- 01/01/2000 + 15 (dias) = 16/01/2000" /> <br />
                                    <h:outputLabel value="- 29/03/1999 + 9 (dias) = 07/04/1999" />
                                </h:panelGrid>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_modelos_arquivos" width="800" closable="true" header="Modelos de documentos" modal="true">
                                <h:panelGrid columns="1" id="i_m_a">
                                    <p:dataTable value="#{contratoBean.listModeloDocumentos}" var="modeloDocumentos">
                                        <p:column width="30" styleClass="text-center">
                                            <p:selectBooleanCheckbox value="#{modeloDocumentos.selected}">
                                                <p:ajax event="change" update="@this" />
                                            </p:selectBooleanCheckbox>                                            
                                        </p:column>
                                        <p:column headerText="Modelo">
                                            <p:outputLabel value="#{modeloDocumentos.descricao}" />
                                        </p:column>
                                        <p:column width="30">
                                            <h:commandLink action="#{contratoBean.imprimirOutros(modeloDocumentos.modeloContrato.id)}" disabled="#{contratoBean.contrato.id == null}" rendered="#{contratoBean.contrato.id != null}">
                                                <p:button icon="ui-icon-print" />
                                            </h:commandLink>
                                        </p:column>
                                    </p:dataTable>
                                </h:panelGrid>
                                <f:facet name="footer">
                                    <p:commandButton action="#{contratoBean.imprimirOutros}" value="Imprimir" ajax="false"/>
                                </f:facet>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_delete" width="400" closable="true" header="Deseja excluir este contrato?" modal="true">
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton action="#{contratoBean.delete}" value="Confirmar" update=":form_contrato:" oncomplete="PF('dlg_save').hide(); PF('dlg_message').show();"/>
                                        <p:commandButton value="Cancelar" onclick="PF('dlg_delete').hide()"/>
                                    </h:panelGrid>
                                </f:facet>                                
                            </p:dialog>
                            <p:dialog widgetVar="dlg_message" width="400" closable="true" header="Mensagem" modal="true">
                                <p:messages showDetail="true" showIcon="true" autoUpdate="true" closable="true" />
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <p:commandButton value="Ok" onclick="PF('dlg_message').hide()"/>
                                    </h:panelGrid>
                                </f:facet>                                
                            </p:dialog>
                            <p:dialog widgetVar="dlg_imprimir" width="400" closable="true" header="Tem certeza que deseja gerar este contrato?" modal="true">
                                <f:facet name="footer">
                                    <h:panelGrid columns="2">
                                        <h:commandLink action="#{contratoBean.imprimir}" value="Confirmar">
                                        </h:commandLink>
                                        <p:commandButton value="Cancelar" onclick="PF('dlg_imprimir').hide()"/>
                                    </h:panelGrid>
                                </f:facet>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_update_ftipo_documento_ctr" width="600" closable="true" header="Movimento/Boleto" modal="true" dynamic="true">
                                <h:panelGrid columns="2" id="id_update_ftipo_documento_ctr" columnClasses="verticalAlignTop,verticalAlignTop">
                                    <p:outputLabel value="Alterar tipo de documento: " />
                                    <p:selectOneMenu value="#{contratoBean.idFTipoDocumento}" disabled="#{contratoBean.updateMovimento.id != -1}">
                                        <p:ajax event="change" update=":form_contrato:" listener="#{contratoBean.updateFTipoDocumento(0)}" oncomplete="PF('dlg_update_ftipo_documento_ctr').hide();"/>
                                        <f:selectItems value="#{contratoBean.listFTipoDocumento}" />
                                    </p:selectOneMenu>
                                    <p:outputLabel value="Mensagem Boleto: " rendered="#{contratoBean.contrato.id != null}"/>
                                    <p:inputTextarea  value="#{contratoBean.mensagem[0]}" maxlength="1000" cols="50" rows="20" rendered="#{contratoBean.contrato.id != null}">
                                        <p:ajax event="change" update="@this" />
                                    </p:inputTextarea>
                                    <h:column />
                                    <h:panelGrid columns="2" rendered="#{contratoBean.contrato.id != null}">
                                        <f:facet name="header">Salvar Mensagem</f:facet>
                                        <p:commandButton value="Somente este boleto" action="#{contratoBean.saveMensagemBoleto(1)}" update=":form_contrato:" />
                                        <p:commandButton value="Todos boletos"  action="#{contratoBean.saveMensagemBoleto(0)}" update=":form_contrato:"/>
                                    </h:panelGrid>                                    
                                </h:panelGrid>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_update_ftipo_documento_taxas" width="600" closable="true" header="Movimento/Boleto" modal="true" dynamic="true">
                                <h:panelGrid columns="2" id="id_update_ftipo_documento_taxas" columnClasses="verticalAlignTop,verticalAlignTop">
                                    <p:outputLabel value="Alterar tipo de documento: " />
                                    <p:selectOneMenu value="#{contratoBean.idFTipoDocumento}">
                                        <p:ajax event="change" update=":form_contrato:" listener="#{contratoBean.updateFTipoDocumento(1)}" oncomplete="PF('dlg_update_ftipo_documento_taxas').hide();"/>
                                        <f:selectItems value="#{contratoBean.listFTipoDocumento}" />
                                    </p:selectOneMenu>
                                    <p:outputLabel value="Mensagem Boleto: " rendered="#{contratoBean.contrato.id != null}"/>
                                    <p:inputTextarea value="#{contratoBean.mensagem[1]}" maxlength="1000" cols="50" rows="20" rendered="#{contratoBean.contrato.id != null}">
                                        <p:ajax event="change" update="@this" />
                                    </p:inputTextarea>
                                    <h:column />
                                    <h:panelGrid columns="2" rendered="#{contratoBean.contrato.id != null}">
                                        <f:facet name="header">Salvar Mensagem</f:facet>
                                        <p:commandButton value="Somente este boleto" action="#{contratoBean.saveMensagemBoleto(1)}" update=":form_contrato:"/>
                                        <p:commandButton value="Todos boletos"  action="#{contratoBean.saveMensagemBoleto(0)}" update=":form_contrato:"/>
                                    </h:panelGrid>
                                </h:panelGrid>                               
                            </p:dialog>
                            <p:dialog widgetVar="dlg_rescindir" width="400" closable="true" header="Deseja rescindir este contrato?" modal="true">
                                <f:facet name="footer">
                                    <p:commandButton action="#{contratoBean.action(1)}" update=":form_contrato:i_desligamento" value="Confirma" oncomplete="PF('dlg_rescindir').hide()"/>
                                </f:facet>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_rescindir_2" width="400" closable="true" header="Deseja desfazer esta rescisão?" modal="true">
                                <f:facet name="footer">
                                    <p:commandButton action="#{contratoBean.action(2)}" update=":form_contrato:i_desligamento" value="Confirmar" oncomplete="PF('dlg_rescindir_2').hide()"/>
                                </f:facet>
                            </p:dialog>
                            <p:dialog widgetVar="dlg_dia_vencimento" width="400" closable="true" header="Dia do vencimento" modal="true" resizable="false" closeOnEscape="true" draggable="false">
                                <h:panelGrid columns="2" style="width: 100%">
                                    <p:outputLabel value="Escolha o melhor dia:" />
                                    <p:selectOneMenu value="#{contratoBean.diaVencimento}">
                                        <p:ajax event="change" listener="#{contratoBean.geraParcelas()}" update="i_tbl" global="false"/>
                                        <f:selectItem itemValue="1" itemLabel="1" />
                                        <f:selectItem itemValue="2" itemLabel="2" />
                                        <f:selectItem itemValue="3" itemLabel="3" />
                                        <f:selectItem itemValue="4" itemLabel="4" />
                                        <f:selectItem itemValue="5" itemLabel="5" />
                                        <f:selectItem itemValue="6" itemLabel="6" />
                                        <f:selectItem itemValue="7" itemLabel="7" />
                                        <f:selectItem itemValue="8" itemLabel="8" />
                                        <f:selectItem itemValue="9" itemLabel="9" />
                                        <f:selectItem itemValue="10" itemLabel="10" />
                                        <f:selectItem itemValue="11" itemLabel="11" />
                                        <f:selectItem itemValue="12" itemLabel="12" />
                                        <f:selectItem itemValue="13" itemLabel="13" />
                                        <f:selectItem itemValue="14" itemLabel="14" />
                                        <f:selectItem itemValue="15" itemLabel="15" />
                                        <f:selectItem itemValue="16" itemLabel="16" />
                                        <f:selectItem itemValue="17" itemLabel="17" />
                                        <f:selectItem itemValue="18" itemLabel="18" />
                                        <f:selectItem itemValue="19" itemLabel="19" />
                                        <f:selectItem itemValue="20" itemLabel="20" />
                                        <f:selectItem itemValue="21" itemLabel="21" />
                                        <f:selectItem itemValue="22" itemLabel="22" />
                                        <f:selectItem itemValue="23" itemLabel="23" />
                                        <f:selectItem itemValue="24" itemLabel="24" />
                                        <f:selectItem itemValue="25" itemLabel="25" />
                                        <f:selectItem itemValue="26" itemLabel="26" />
                                        <f:selectItem itemValue="27" itemLabel="27" />
                                        <f:selectItem itemValue="28" itemLabel="28" />
                                        <f:selectItem itemValue="29" itemLabel="29" />
                                        <f:selectItem itemValue="30" itemLabel="30" />
                                        <f:selectItem itemValue="31" itemLabel="31" />
                                    </p:selectOneMenu>
                                </h:panelGrid>
                            </p:dialog>
                        </h:form>
                    </p:panel>
                </f:view>
                <!-- FINALIZA div wrap main -->
            </div>
        </div>
        <!-- FINALIZA div wrap main -->

        <div id="footerx">
            <f:subview id="footer">
                <ui:include src="templates/templateFooter.xhtml"/>
            </f:subview>
        </div>                
    </h:body>
</ui:composition>